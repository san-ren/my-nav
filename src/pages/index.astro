---
import siteConfig from '../data/config.json';
// 获取 nav 文件夹下第一个文件
const allNavFiles = import.meta.glob('../data/nav/*.json', { eager: true });
const navResources = Object.values(allNavFiles);
const section = navResources[0] as any;
// ... 后续同 [id].astro
---

<Layout title={`${section.name} - ${siteConfig.title}`}>
  <div class="flex min-h-screen">
    
    <!-- 侧边栏 Sidebar -->
    <aside class="fixed inset-y-0 left-0 z-40 w-64 bg-white/40 dark:bg-gray-900/60 backdrop-blur-2xl border-r border-slate-200/50 dark:border-gray-800/50 hidden md:block">
      <div class="p-6 mb-2 flex items-center gap-3">
        <div class="w-9 h-9 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30">
          <img src={`${base}/favicon.svg`} class="w-6 h-6 invert brightness-0" alt="Logo" />
        </div>
        <span class="text-lg font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-500 dark:from-white dark:to-slate-400">
          {siteConfig.title}
        </span>
      </div>
      
      <nav class="p-4 space-y-2">
        {navResources.map((item) => {
          const isActive = item.id === id;
          return (
            <a href={`${base}/${item.id}`} 
               class={`relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 group
               ${isActive 
                 ? 'bg-white dark:bg-gray-800 text-blue-600 shadow-[0_10px_25px_-5px_rgba(59,130,246,0.2)] translate-x-1 font-bold' 
                 : 'text-slate-500 hover:text-slate-900 dark:hover:text-white hover:translate-x-1'
               }`}
            >
              {isActive && <div class="absolute left-0 w-1.5 h-5 bg-blue-600 rounded-r-full shadow-[4px_0_12px_rgba(37,99,235,0.6)]"></div>}
              <LayoutDashboard size={18} /> 
              <span class="text-[14px]">{item.name}</span>
            </a>
          );
        })}
      </nav>
    </aside>

    <main class="flex-1 md:ml-64">
      <header class="sticky top-0 z-30 flex items-center justify-between px-8 py-4 bg-white/40 dark:bg-gray-900/40 backdrop-blur-md border-b border-slate-200/50 dark:border-gray-800/50">
        <h1 class="text-xl font-black flex items-center gap-3 text-slate-800 dark:text-white">
          <div class="p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-600"><CurrentIcon size={20} /></div>
          {section.name}
        </h1>
        <div class="flex items-center gap-3">
          <SearchModal client:load />
          <button id="theme-toggle" class="p-2.5 bg-slate-100 dark:bg-gray-800 rounded-xl text-slate-500 hover:text-blue-600 transition-all"><Sun size={20} className="hidden dark:block" /><Moon size={20} className="block dark:hidden" /></button>
        </div>
      </header>

      <div class="p-8 space-y-16 max-w-7xl">
        {section.categories.map((category, catIdx) => (
          <section class="category-group">
            <div class="flex flex-row items-center justify-start gap-8 mb-8">
              <h2 class="flex items-center gap-3 text-lg font-bold text-slate-800 dark:text-slate-100 shrink-0">
                <span class="w-2 h-7 bg-gradient-to-b from-blue-500 to-indigo-600 rounded-full shadow-lg shadow-blue-500/20"></span>
                {category.name}
              </h2>

              {category.tabs && (
                <div class="flex bg-slate-200/50 dark:bg-gray-800/50 p-1 rounded-2xl gap-1 backdrop-blur-sm">
                  {category.tabs.map((tab, tabIdx) => (
                    <button
                      class={`tab-btn px-6 py-1.5 text-xs font-bold rounded-xl transition-all duration-300
                      ${tabIdx === 0 
                        ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/40 scale-105' 
                        : 'text-slate-500 hover:text-slate-800 dark:text-slate-400'
                      }`}
                      data-target={`pane-${catIdx}-${tabIdx}`}
                    >
                      {tab.tabName}
                    </button>
                  ))}
                </div>
              )}
            </div>

            <div class="tab-content">
              {category.tabs ? (
                category.tabs.map((tab, tabIdx) => (
                  <div id={`pane-${catIdx}-${tabIdx}`} class={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-6 tab-pane ${tabIdx !== 0 ? 'hidden' : ''}`}>
                    {tab.list.map((site) => <SiteCard {...site} />)}
                  </div>
                ))
              ) : (
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                  {category.list?.map((site) => <SiteCard {...site} />)}
                </div>
              )}
            </div>
          </section>
        ))}
        
        <footer class="mt-20 py-10 text-center text-[13px] text-slate-400 border-t border-slate-200/50 dark:border-gray-800/50">
          <p>Made with ❤️ by {siteConfig.author} © {new Date().getFullYear()}</p>
        </footer>
      </div>
    </main>
  </div>
</Layout>

<script is:inline>
  function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const parent = btn.closest('.category-group');
        const targetId = btn.getAttribute('data-target');

        parent.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600', 'text-white', 'shadow-lg', 'shadow-blue-500/40', 'scale-105');
          b.classList.add('text-slate-500');
        });
        btn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600', 'text-white', 'shadow-lg', 'shadow-blue-500/40', 'scale-105');
        btn.classList.remove('text-slate-500');

        parent.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
        document.getElementById(targetId).classList.remove('hidden');
      });
    });
  }
  initTabs();
  document.addEventListener('astro:after-swap', initTabs);
</script>